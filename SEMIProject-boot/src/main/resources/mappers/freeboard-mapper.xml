<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="edu.kh.semi.board.model.mapper.FreeBoardMapper">

	<!-- 게시글 전체 수 조회 (페이징 계산용) -->
	<select id="selectFreeListCount" resultType="int">
		SELECT COUNT(*)
		FROM
		BOARD
		WHERE BOARD_DEL_FL = 'N'
		AND BOARD_CODE = 2
	</select>

	<!-- 자유게시판 페이징 목록 조회 -->
	<select id="selectFreeList" parameterType="Pagination"
		resultType="Board">
		SELECT
		B.BOARD_NO,
		B.BOARD_TITLE,
		M.MEMBER_NICKNAME,
		TO_CHAR(B.BOARD_WRITE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS
		BOARD_WRITE_DATE,
		B.READ_COUNT
		FROM "BOARD" B
		JOIN "MEMBER" M ON
		B.MEMBER_NO = M.MEMBER_NO
		WHERE B.BOARD_DEL_FL = 'N'
		AND B.BOARD_CODE =
		2
		ORDER BY B.BOARD_NO DESC
		OFFSET #{startRow} ROWS FETCH NEXT #{limit}
		ROWS ONLY
	</select>

	<!-- 자유게시판 글쓰기 -->
	<insert id="insertFreeBoard" parameterType="Board"
		useGeneratedKeys="true" keyProperty="boardNo">
		INSERT INTO BOARD (
		BOARD_NO,
		BOARD_TITLE, BOARD_CONTENT,
		MEMBER_NO, BOARD_CODE, READ_COUNT,
		BOARD_DEL_FL, BOARD_WRITE_DATE
		) VALUES (
		SEQ_BOARD_NO.NEXTVAL,
		#{boardTitle},
		#{boardContent},
		#{memberNo},
		#{boardCode},
		0,
		'N',
		SYSDATE
		)
	</insert>

	<resultMap id="board_rm" type="Board">
		<id property="boardNo" column="BOARD_NO" />
		<result property="boardTitle" column="BOARD_TITLE" />
		<result property="boardContent" column="BOARD_CONTENT" />
		<result property="boardWriteDate" column="BOARD_WRITE_DATE" />
		<result property="boardUpdateDate" column="BOARD_UPDATE_DATE" />
		<result property="readCount" column="READ_COUNT" />
		<result property="boardDelFl" column="BOARD_DEL_FL" />
		<result property="boardCode" column="BOARD_CODE" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="qaStatus" column="QA_STATUS" />
		<result property="boardTypeName" column="BOARD_TYPE_NAME" />
		<result property="memberNickname" column="MEMBER_NICKNAME" />
		<result property="commentCount" column="COMMENT_COUNT" />
		<result property="profileImg" column="PROFILE_IMG" />
		<result property="thumbnail" column="THUMBNAIL" />
		<result property="authority" column="AUTHORITY" />
	</resultMap>

	<select id="selectFreeBoard" parameterType="long"
		resultMap="board_rm">
		SELECT
		B.BOARD_NO,
		B.BOARD_TITLE,
		B.BOARD_CONTENT,
		B.BOARD_WRITE_DATE AS BOARD_WRITE_DATE,
		B.BOARD_UPDATE_DATE,
		B.READ_COUNT,
		B.BOARD_DEL_FL,
		B.BOARD_CODE,
		B.MEMBER_NO,
		B.QA_STATUS,
		M.MEMBER_NICKNAME,
		M.MEMBER_IMG AS
		PROFILE_IMG,
		(
		SELECT IMG_PATH ||
		IMG_RENAME
		FROM BOARD_IMAGE
		WHERE
		BOARD_NO = B.BOARD_NO
		AND IMG_ORDER = 0
		) AS THUMBNAIL
		FROM BOARD B
		JOIN
		MEMBER M ON B.MEMBER_NO = M.MEMBER_NO
		WHERE B.BOARD_NO = #{boardNo}
	</select>

	<!-- 자유게시판 게시글 수정 -->
	<update id="updateFreeBoard" parameterType="Board">
		UPDATE BOARD
		SET
		BOARD_TITLE = #{boardTitle},
		BOARD_CONTENT = #{boardContent},
		BOARD_UPDATE_DATE = SYSDATE
		WHERE
		BOARD_NO = #{boardNo}
		AND BOARD_CODE = 2
	</update>

</mapper>
