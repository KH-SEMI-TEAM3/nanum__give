<!-- /templates/share/shareList.html -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>나눔 게시판</title>
    <th:block th:replace="~{common/common}"></th:block>
  </head>
  <body>
    <th:block th:replace="~{common/header}"></th:block>

    <main>
      <!-- 정렬 필터-->
      <div class="share-filter-area">
        <select id="categoryCode" name="categoryCode">
          <option value="">-- 선택 --</option>
		  <option value="물건" th:selected="${categoryCode == 0}">물건</option>
		  <option value="재능" th:selected="${categoryCode == 1}">재능</option>
        </select>
        <select id="categoryDetailCode" name="categoryDetailCode">
          <option value="">-- 세부 선택 --</option>
		  <!-- JS로 옵션 추가 -->
        </select>
        <button id="category-search-btn" type="button">검색</button>
        <div id="loading-indicator" style="display: none; margin-left: 10px;">
          <img src="/images/loading.gif" alt="로딩중" style="width: 20px; height: 20px;">
          <span>로딩중...</span>
        </div>
      </div>

      <div class="list-wrapper">
        <div th:if="${#lists.isEmpty(boardList)}" class="empty-message">
          게시글이 존재하지 않습니다.
        </div>
        <th:block th:each="board : ${boardList}" th:object="${board}">
          <div class="board-item" th:onclick="|location.href='@{/share/detail/{boardNo}(boardNo=${board.boardNo},cp=${pagination.currentPage})}'|">
            <div class="board-thumbnail">
              <img th:src="@{*{thumbnail}}" alt="썸네일">
            </div>
            <div class="board-content">
              <div class="board-status-line">
                <div class="board-status" th:classappend="${board.shareStatus == 'Y'} ? 'completed'" th:text="*{shareStatus == 'Y' ? '나눔완료' : '나눔중'}"></div>
              </div>
              <div class="board-title-line">
                <div class="board-title" th:text="*{boardTitle}">제목</div>
              </div>
              <div class="board-meta">
                <span>카테고리: <span th:text="*{shareBoardCategoryName}">카테고리</span></span>
                <span>세부카테고리: <span th:text="*{shareBoardCategoryDetailName}">세부카테고리</span></span>
                <span>작성자: <span th:text="*{memberNickname}">닉네임</span></span>
                <span>작성일: <span th:text="*{boardWriteDate}">날짜</span></span>
                <span>조회수: <span th:text="*{readCount}">0</span></span>
                <span>찜: <span th:text="*{jjimCount}">0</span></span>
              </div>
            </div>
          </div>
        </th:block>
      </div>
      <a th:href="@{/shareEdit/insert}">
        <button id="insertBtn" th:if="${session.loginMember!=null and session.loginMember.authority != 0}">글쓰기</button>
      </a>

      <div
        class="pagination-area"
        th:if="${pagination != null}"
        th:object="${pagination}"
      >

        <!-- 검색 X -->
        <th:block th:if="${param.categoryCode == null and param.mainCategory == null}">
            <a th:href="@{/share/list(cp=1)}"
            th:if="${pagination.currentPage > 1}"
            >
              <button>&laquo;</button>
            </a>
            <a th:href="@{/share/list(cp=*{prevPage})}"
            th:if="${pagination.currentPage > 1}"
            >
              <button>&lt;</button>
            </a>
        
            <th:block th:each="i : *{#numbers.sequence(startPage, endPage)}">
              <a th:if="${i} == *{currentPage}">
                <button class="active" th:text="${i}">1</button>
              </a>
              <a
              th:unless="${i} == *{currentPage}"
              th:href="@{/share/list(cp=${i})}"
              >
                <button th:text="${i}">1</button>
              </a>
            </th:block>
            <a th:href="@{/share/list(cp=*{nextPage})}"
            th:if="${pagination.currentPage < pagination.maxPage}"
            >
              <button>&gt;</button>
            </a>
            <a th:href="@{/share/list(cp=*{maxPage})}"
            th:if="${pagination.currentPage < pagination.maxPage}"
            >
              <button>&raquo;</button>
            </a>
        </th:block>

        <!-- 검색 O -->
        <th:block th:if="${param.categoryCode != null or param.mainCategoryCode != null}">
          <a th:href="@{/share/list(cp=1, 
              ${param.categoryCode != null ? 'categoryCode=' + param.categoryCode : 'mainCategoryCode=' + param.mainCategoryCode})}"
            th:if="${pagination.currentPage > 1}">
            <button>&laquo;</button>
          </a>
    
          <a th:href="@{/share/list(cp=*{prevPage}, 
              ${param.categoryCode != null ? 'categoryCode=' + param.categoryCode : 'mainCategoryCode=' + param.mainCategoryCode})}"
            th:if="${pagination.currentPage > 1}">
            <button>&lt;</button>
          </a>
    
          <th:block th:each="i : *{#numbers.sequence(startPage, endPage)}">
            <a th:if="${i} == *{currentPage}">
              <button class="active" th:text="${i}">1</button>
            </a>
            <a th:unless="${i} == *{currentPage}"
              th:href="@{/share/list(cp=${i}, 
                ${param.categoryCode != null ? 'categoryCode=' + param.categoryCode : 'mainCategoryCode=' + param.mainCategoryCode})}">
              <button th:text="${i}">1</button>
            </a>
          </th:block>
    
          <a th:href="@{/share/list(cp=*{nextPage}, 
              ${param.categoryCode != null ? 'categoryCode=' + param.categoryCode : 'mainCategoryCode=' + param.mainCategoryCode})}"
            th:if="${pagination.currentPage < pagination.maxPage}">
            <button>&gt;</button>
          </a>
    
          <a th:href="@{/share/list(cp=*{maxPage}, 
              ${param.categoryCode != null ? 'categoryCode=' + param.categoryCode : 'mainCategoryCode=' + param.mainCategoryCode})}"
            th:if="${pagination.currentPage < pagination.maxPage}">
            <button>&raquo;</button>
          </a>
        </th:block>
      </div>
</main>


<th:block th:replace="~{common/footer}"></th:block>
<script th:src="@{/js/board/share/share.js}"></script>
</body>
</html>
