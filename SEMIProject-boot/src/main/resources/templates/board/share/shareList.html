<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>나눔 게시판</title>
    <th:block th:replace="~{common/common}"></th:block>
    <link rel="stylesheet" th:href="@{/css/share/shareList.css}" />
  </head>
  <body>
    <th:block th:replace="~{common/header}"></th:block>

    <main class="share-board-page">
      <h1 class="board-header">나눔 게시판</h1>
      <!-- 카테고리 필터 -->
      <div class="share-filter-area">
        <div class="dropdown-container">
          <select id="main-category" name="categoryCode">
            <option value="">-- 선택 --</option>
            <option value="물건" th:selected="${param.mainCategory == '물건'}">물건</option>
            <option value="재능" th:selected="${param.mainCategory == '재능'}">재능</option>
          </select>
        </div>
        <div class="dropdown-container">
          <select id="sub-category" name="categoryDetailCode" onchange="submitSubCategory()">
            <option value="">-- 세부 선택 --</option>
            <!-- JS로 옵션 추가 -->
          </select>
        </div>
      </div>

      <!-- 게시글 목록 -->
      <div class="list-wrapper">
        <div th:if="${#lists.isEmpty(boardList)}" class="empty-message">
          게시글이 존재하지 않습니다.
        </div>
        <th:block th:each="board : ${boardList}" th:object="${board}">
          <div class="board-item" th:onclick="goToDetail([[${board.boardNo}]])">
            <div class="board-thumbnail">
              <img th:src="@{*{thumbnail}}" alt="썸네일">
            </div>
            <div class="board-content">
              <div class="board-status-line">
                <div class="board-status" th:classappend="${board.shareStatus == 'Y'} ? 'completed'" th:text="*{shareStatus == 'Y' ? '나눔완료' : '나눔중'}"></div>
              </div>
              <div class="board-title-line">
                <!-- <div class="board-title" th:text="*{boardTitle}">제목
                  
                </div>
                 -->

                   <div class="board-title">
    <span th:text="*{boardTitle}">제목</span>
    <span class="comment-count" th:text="' [' + *{commentCount} + ']'"></span>
  </div>
              </div>
              <div class="board-meta">
                <span>카테고리: <span th:text="*{shareBoardCategoryName}">카테고리</span></span>
                <span>세부카테고리: <span th:text="*{shareBoardCategoryDetailName}">세부카테고리</span></span>
                <span>작성자: <span th:text="*{memberNickname}">닉네임</span></span>
                <span>작성일: <span th:text="*{boardWriteDate}">날짜</span></span>
                <span>조회수: <span th:text="*{readCount}">0</span></span>
                <span>찜: <span th:text="*{jjimCount}">0</span></span>
              </div>
            </div>
          </div>
        </th:block>
      </div>

      <!-- 검색 + 글쓰기 영역 -->
      <div class="search-area-wrap">
        <div class="search-area">
          <form action="/share/list" method="get">
            <select name="searchType">
              <option value="title" th:selected="${param.searchType == 'title'}">제목</option>
              <option value="content" th:selected="${param.searchType == 'content'}">내용</option>
              <option value="nickname" th:selected="${param.searchType == 'nickname'}">작성자</option>
            </select>

            <div class="search-input-wrap">
              <input
                type="text"
                placeholder="검색어를 입력해주세요."
                name="searchKeyword"
                th:value="${param.searchKeyword}" />
              <button type="submit" class="icon-search">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24">
                  <circle cx="11" cy="11" r="8" />
                  <line x1="21" y1="21" x2="16.65" y2="16.65" />
                </svg>
              </button>
            </div>
          </form>
        </div>

        <!-- 로그인한 사용자만 글쓰기 버튼 노출 -->
        <div class="button-area" th:if="${session.loginMember != null and session.loginMember.authority != 0}">
          <a th:href="@{/shareEdit/insert}">
            <button type="button" class="write-btn">글쓰기</button>
          </a>
        </div>
      </div>


      <div
        class="pagination-area"
        th:if="${pagination != null}"
        th:object="${pagination}"
      >

        <!-- 검색 X -->
        <th:block th:if="${param.categoryCode == null and param.mainCategory == null and param.searchType ==null and param.searchKeyword == null}">
            <a th:href="@{/share/list(cp=1)}"
            th:if="${pagination.currentPage > 1}"
            >
              <button>&laquo;</button>
            </a>
            <a th:href="@{/share/list(cp=*{prevPage})}"
            th:if="${pagination.currentPage > 1}"
            >
              <button>&lt;</button>
            </a>
        
            <th:block th:each="i : *{#numbers.sequence(startPage, endPage)}">
              <a th:if="${i} == *{currentPage}">
                <button class="active" th:text="${i}">1</button>
              </a>
              <a
              th:unless="${i} == *{currentPage}"
              th:href="@{/share/list(cp=${i})}"
              >
                <button th:text="${i}">1</button>
              </a>
            </th:block>
            <a th:href="@{/share/list(cp=*{nextPage})}"
            th:if="${pagination.currentPage < pagination.maxPage}"
            >
              <button>&gt;</button>
            </a>
            <a th:href="@{/share/list(cp=*{maxPage})}"
            th:if="${pagination.currentPage < pagination.maxPage}"
            >
              <button>&raquo;</button>
            </a>
        </th:block>

        <!-- 검색 O -->
        <th:block th:if="${param.categoryCode != null or param.mainCategory != null or param.searchType != null or param.searchKeyword != null}">
          <a th:href="@{/share/list(cp=1, mainCategory=${param.mainCategory}, subCategory=${param.subCategory}, searchType=${param.searchType}, searchKeyword=${param.searchKeyword})}"
            th:if="${pagination.currentPage > 1}">
            <button>&laquo;</button>
          </a>
          <a th:href="@{/share/list(cp=*{prevPage}, mainCategory=${param.mainCategory}, subCategory=${param.subCategory}, searchType=${param.searchType}, searchKeyword=${param.searchKeyword})}"
          th:if="${pagination.currentPage > 1}"
          >
            <button>&lt;</button>
          </a>
          
          <th:block th:each="i : ${#numbers.sequence(pagination.startPage, pagination.endPage)}">
            <a th:if="${i == pagination.currentPage}">
              <button class="active" th:text="${i}">1</button>
            </a>
            <a th:unless="${i == pagination.currentPage}"
              th:href="@{/share/list(cp=${i}, mainCategory=${param.mainCategory}, subCategory=${param.subCategory}, searchType=${param.searchType}, searchKeyword=${param.searchKeyword})}">
              <button th:text="${i}">1</button>
            </a>
          </th:block>

          <a th:href="@{/share/list(cp=${pagination.nextPage}, mainCategory=${param.mainCategory}, subCategory=${param.subCategory}, searchType=${param.searchType}, searchKeyword=${param.searchKeyword})}"
            th:if="${pagination.currentPage < pagination.maxPage}">
            <button>&gt;</button>
          </a>
          <a th:href="@{/share/list(cp=${pagination.maxPage}, mainCategory=${param.mainCategory}, subCategory=${param.subCategory}, searchType=${param.searchType}, searchKeyword=${param.searchKeyword})}"
            th:if="${pagination.currentPage < pagination.maxPage}">
            <button>&raquo;</button>
          </a>
        </th:block>

      </div>
</main>

    <!-- 메시지 JS 처리 -->
    <script th:inline="javascript">
      const flashMessage = /*[[${message}]]*/ null;
      if (flashMessage != null) alert(flashMessage);

      const selectedMain = /*[[${param.mainCategory}]]*/ "";
      const selectedSub = /*[[${param.subCategory}]]*/ "";
      const searchType = /*[[${param.searchType}]]*/ "";
      const searchKeyword = /*[[${param.searchKeyword}]]*/ "";

      function goToDetail(boardNo) {
        const query = location.search; // ?cp=1 등
        location.href = `/share/detail/${boardNo}${query}`;
      }

    </script>
<th:block th:replace="~{common/footer}"></th:block>
<script th:src="@{/js/board/share/share.js}"></script>
</body>
</html>
