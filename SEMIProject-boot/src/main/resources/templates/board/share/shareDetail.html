<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>나눔 게시판 - 상세</title>
    <!-- templates/common/common.html 조각으로 추가 -->
    <th:block th:replace="~{common/common}"></th:block>
    <link rel="stylesheet" th:href="@{/css/share/shareDetail.css}" />
  </head>
  <body>
    <th:block th:replace="~{common/header}" />

    <main>
      <div class="card" th:object="${board}">
        <div class="card-header">
          <h2 class="mb-0" th:text="*{boardTitle}">제목</h2>

          <th:block
            th:if="${session.loginMember != null
          and board.memberNo != session.loginMember.memberNo}"
            class="send-message"
          >
            <form
              th:action="@{/message/send}"
              method="post"
              style="display: inline"
            >
              <input
                type="hidden"
                name="memberNo"
                th:value="${board.memberNo}"
              />
              <input type="hidden" name="boardNo" th:value="${board.boardNo}" />

              <button type="submit" title="쪽지 보내기">
                <span>쪽지 보내기</span>
              </button>
            </form>
          </th:block>

          <div class="d-flex justify-content-between align-items-center mt-2">
            <div>
              <span class="me-3" th:text="*{memberNickname}">작성자</span>
              <span class="me-3" th:text="*{shareBoardCategoryName}"
                >대분류</span
              >
              <span class="me-3" th:text="*{shareBoardCategoryDetailName}"
                >소분류</span
              >
              <span class="text-muted" th:text="*{boardWriteDate}">작성일</span>
            </div>
            <div>
              <span class="me-2">조회수: </span>
              <span th:text="*{readCount}">0</span>
              <span class="me-2">나눔 상태: </span>

              <button
                id="shareStatus"
                th:class="${board.memberNo == session.loginMember?.memberNo} ? 'btn btn-primary' : 'btn btn-secondary'"
                th:disabled="${board.memberNo != session.loginMember?.memberNo}"
                th:text="${board.shareStatus == 'Y'} ? '나눔완료' : '나눔중'"
                th:data-status="${board.shareStatus}"
              >
                나눔중
              </button>
              <!-- 찜 하트 -->
              <th:block
                th:if="${session.loginMember == null or session.loginMember.authority != 0}"
              >
                <span class="like-area">
                  <span
                    id="jjimIcon"
                    th:class="material-symbols-outlined"
                    style="cursor: pointer"
                    >favorite</span
                  >
                  <span id="jjimCount" th:text="*{jjimCount}">0</span>
                </span>
              </th:block>

              <th:block
                th:if="${session.loginMember != null and session.loginMember.authority == 0}"
              >
                <button id="adminMemberDeleteBtn">관리자 회원삭제</button>
              </th:block>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="mb-4"></div>
          <div class="content mb-4" th:utext="*{boardContent}">내용</div>
        </div>
        <div class="card-footer">
          <div class="d-flex justify-content-between">
            <div>
              <button
                th:href="@{/share/list(cp=${param.cp})}"
                id="goToListBtn"
                class="btn btn-secondary"
              >
                목록으로
              </button>
            </div>

            <th:block
              th:if="${board.memberNo == session.loginMember?.memberNo}"
            >
              <button id="updateBtn">수정</button>
              <button id="deleteBtn">삭제</button>
            </th:block>
          </div>
          <th:block
            th:if="${session.loginMember != null and session.loginMember.authority == 0}"
          >
            <button id="adminBoardDeleteBtn">관리자 글 삭제</button>
          </th:block>
        </div>
      </div>

      <th:block th:replace="~{board/comment}"></th:block>
    </main>

    <th:block th:replace="~{common/footer}" />

    <script th:inline="javascript">
      // - loginMember가 null 인 경우 null 반환
      const loginMemberNo =
        /*[[${session.loginMember?.memberNo}]]*/ "로그인 회원 번호";

      // 현재 게시글 번호를 전역 변수로 저장
      const boardNo = /*[[${board.boardNo}]]*/ "게시글 번호";

      // 현재 게시글 좋아요 여부를 전역 변수로 저장
      let jjimCheck = /*[[${board.jjimCheck}]]*/ 0;

      /* 로그인 되어 있으면 authority 값을, 아니면 null */
      const loginMemberAuthority =
        /*[[${session.loginMember?.authority}]]*/ null;

      // 작성자 체크
      const memberNo = /*[[${board.memberNo}]]*/ null;
      const isAuthor = loginMemberNo === memberNo;

      const cp = /*[[${param.cp ?: 1}]]*/ 1;
    </script>

    <script th:src="@{/js/board/share/shareDetail.js}"></script>

    <script th:src="@{/js/board/share/shareComment.js}"></script>
  </body>
</html>
