<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<title>NonumGive</title>
	<link rel="stylesheet" th:href="@{/css/free/freeboarddetail.css}">
	<th:block th:replace="~{common/common}"></th:block>
</head>

<body th:data-edit-mode="${editMode}">
	<th:block th:replace="~{common/header}" />

	<div class="free-detail-container">
		<div class="free-title-box">
			<th:block th:if="${!editMode}">
				<h1 class="free-title" th:text="${board.boardTitle}"
					th:attr="data-board-no=${board.boardNo}, data-member-no=${board.memberNo}">
				</h1>
			</th:block>

			<input type="text" class="edit-title" th:if="${editMode}" th:value="${board.boardTitle}"
				th:attr="data-board-no=${board.boardNo}, data-member-no=${board.memberNo}" />

			<div class="free-meta">
				<div class="writer-info">
					<img th:if="${board.memberImg  != null}" th:src="@{${board.memberImg}}" class="writer-img"
						alt="ì‘ì„±ì í”„ë¡œí•„ ì´ë¯¸ì§€">

					<img th:unless="${board.memberImg  != null}" th:src="@{/images/user.png}" class="writer-img"
						alt="ê¸°ë³¸ í”„ë¡œí•„ ì´ë¯¸ì§€">
					<span th:text="${board.memberNickname}" class="writer-name">ì‘ì„±ì</span>

					<span th:if="${board.authority == 0}" class="admin-badge">[ê´€ë¦¬ì]</span>
					<th:block th:if="${isAdmin}">
						<div class="admin-control-box">
							<button onclick="deleteBoard()">ğŸ—‘ ê¸€ ì‚­ì œ</button>
							<button onclick="deleteMember()">â›” íšŒì› ì‚­ì œ</button>
						</div>
					</th:block>
				</div>
				<div class="date-view">
					<span th:text="${board.boardWriteDate}">ì‘ì„±ì¼</span>
					<span th:text="'ì¡°íšŒìˆ˜ ' + ${board.readCount}">ì¡°íšŒìˆ˜</span>
				</div>
			</div>
		</div>

		<div class="free-body-box">
			<div class="free-thumbnail" id="thumbnail-area">
				<img th:if="${board.thumbnail != null}" th:src="${board.thumbnail}" alt="ëŒ€í‘œ ì´ë¯¸ì§€">
				<input type="file" name="boardImage" accept="image/*" class="edit-image" th:if="${editMode}">
			</div>

			<div class="free-content" th:if="${!editMode}" th:text="${board.boardContent}">ë³¸ë¬¸</div>
			<textarea class="edit-content" th:if="${editMode}" th:text="${board.boardContent}"></textarea>
		</div>

		<div class="free-btn-area"
			th:if="${session.loginMember != null and board.memberNo == session.loginMember.memberNo}">
			<button class="btn modify" th:if="${!editMode}" onclick="goEditMode()">ìˆ˜ì •</button>
			<button class="btn modify" th:if="${editMode}">ì €ì¥</button>
			<button class="btn cancel" th:if="${editMode}"
				th:onclick="|location.href='@{/free/view/{boardNo}(boardNo=${board.boardNo})}'|">ì·¨ì†Œ</button>
			<button class="btn delete" th:onclick="|confirmDelete(${board.boardNo})|">ì‚­ì œ</button>
		</div>

		<div class="free-btn-area">
			<a class="btn back" th:href="@{/free/list(cp=${cp})}">ëª©ë¡ë³´ê¸°</a>
		</div>

		<th:block th:if="${!editMode}">
			<div class="comment-section">
				<div th:each="comment : ${commentList}" th:with="admin=${isAdmin}" class="comment-box"
					th:class="'comment-box' + (${comment.level} > 1 ? ' child-comment' : '')">

					<div class="comment-header">
						<img th:if="${comment.memberImg != null}" th:src="@{${comment.memberImg}}"
							class="comment-profile" />
						<img th:unless="${comment.memberImg != null}" th:src="@{/images/user.png}"
							class="comment-profile" />

						<span class="comment-writer" th:text="${comment.memberNickname}">ë‹‰ë„¤ì„</span>
						<span class="comment-date" th:text="${comment.commentWriteDate}">ì‘ì„±ì¼</span>
						<th:block th:if="${admin}">
						          <button th:onclick="|deleteComment(${comment.commentNo})|">ğŸ—‘ ëŒ“ê¸€ ì‚­ì œ</button>
						        </th:block>
					</div>

					<div class="comment-content" th:text="${comment.commentContent}">ëŒ“ê¸€ ë‚´ìš©</div>

					<!-- ë‹µê¸€ ë²„íŠ¼ -->
					<button type="button" class="reply-btn" th:data-comment-no="${comment.commentNo}">ë‹µê¸€</button>

					<!-- ëŒ€ëŒ“ê¸€ ì…ë ¥ì°½ -->
					<div class="reply-form" style="display:none;">
						<textarea class="reply-content" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
						<button type="button" class="reply-submit-btn" th:data-parent-no="${comment.commentNo}"
							th:data-board-no="${board.boardNo}">ë“±ë¡</button>
					</div>
				</div>
			</div>

			<div class="comment-form" th:if="${session.loginMember != null}">
				<form onsubmit="return false;">

					<textarea name="commentContent" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
					<button type="submit">ëŒ“ê¸€ ë‹¬ê¸°</button>
				</form>
			</div>
		</th:block>



		<th:block th:replace="~{common/footer}" />
		<script th:src="@{/js/free/freeboarddetail.js}"></script>
		<script th:src="@{/js/free/freecomment.js}"></script>

		<script>
			window.addEventListener("pageshow", function (event) {
				const navType = performance.getEntriesByType("navigation")[0]?.type;
				console.log("pageshow ë°œìƒ / navType: ", navType, "/ persisted:", event.persisted);

				if (event.persisted || navType === "back_forward") {
					console.log("[ë’¤ë¡œê°€ê¸° ê°ì§€] ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰");
					location.reload();
				}
			});
		</script>
</body>

</html>